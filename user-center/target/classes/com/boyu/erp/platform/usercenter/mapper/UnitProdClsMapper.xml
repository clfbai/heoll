<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.boyu.erp.platform.usercenter.mapper.goods.UnitProdClsMapper">
    <resultMap id="BaseResultMap" type="com.boyu.erp.platform.usercenter.entity.goods.UnitProdCls">
        <id column="unit_id" jdbcType="BIGINT" property="unitId"/>
        <id column="prod_cls_id" jdbcType="BIGINT" property="prodClsId"/>
        <result column="sales_mode" jdbcType="CHAR" property="salesMode"/>
        <result column="rcmd_lvl" jdbcType="INTEGER" property="rcmdLvl"/>
        <result column="rt_unit_price" jdbcType="REAL" property="rtUnitPrice"/>
        <result column="ws_unit_price" jdbcType="REAL" property="wsUnitPrice"/>
        <result column="ws_tax_rate" jdbcType="REAL" property="wsTaxRate"/>
        <result column="pu_unit_price" jdbcType="REAL" property="puUnitPrice"/>
        <result column="pu_tax_rate" jdbcType="REAL" property="puTaxRate"/>
        <result column="vender_id" jdbcType="INTEGER" property="venderId"/>
    </resultMap>

    <resultMap id="BaseResultMapByDtl" type="com.boyu.erp.platform.usercenter.vo.purchase.DtlProdVo">
        <result column="prodId" property="prodId"/>
        <result column="prodCode" property="prodCode"/>
        <result column="prodCatId" property="prodCatId"/>
        <result column="prodClsId" property="prodClsId"/>
        <result column="prodClsCode" property="prodClsCode"/>
        <result column="prodName" property="prodName"/>
        <result column="rtUnitPrice" property="rtUnitPrice"/>
        <result column="inputCode" property="inputCode"/>
        <result column="edition" property="edition"/>
        <result column="color" property="color"/>
        <result column="spec" property="spec"/>
        <result column="prodCode" property="prodCode"/>
        <result column="wsUnitPrice" property="wsUnitPrice"/>
        <result column="lstPrice" property="lstPrice"/>
        <result column="uom" property="uom"/>
        <result column="seqNum" property="seqNum"/>
        <result column="wsTaxRate" property="wsTaxRate"/>
    </resultMap>

    <sql id="Base_Column_List">
    unit_id, prod_cls_id, sales_mode, rcmd_lvl, rt_unit_price, ws_unit_price, ws_tax_rate, 
    pu_unit_price, pu_tax_rate, vender_id
  </sql>
    <select id="selectUnitProdCls" parameterType="com.boyu.erp.platform.usercenter.entity.goods.UnitProdCls"
            resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from unit_prod_cls
        where unit_id = #{unitId,jdbcType=BIGINT}
        and prod_cls_id = #{prodClsId,jdbcType=BIGINT}
    </select>
    <delete id="deleteUnitProdCls" parameterType="com.boyu.erp.platform.usercenter.entity.goods.UnitProdCls">
    delete from unit_prod_cls
    where unit_id = #{unitId,jdbcType=BIGINT}
      and prod_cls_id = #{prodClsId,jdbcType=BIGINT}
  </delete>
    <insert id="insertUnitProdCls" parameterType="com.boyu.erp.platform.usercenter.entity.goods.UnitProdCls">
    insert into unit_prod_cls (unit_id, prod_cls_id, sales_mode, 
      rcmd_lvl, rt_unit_price, ws_unit_price, 
      ws_tax_rate, pu_unit_price, pu_tax_rate, 
      vender_id)
    values (#{unitId,jdbcType=BIGINT}, #{prodClsId,jdbcType=BIGINT}, #{salesMode,jdbcType=CHAR}, 
      #{rcmdLvl,jdbcType=INTEGER}, #{rtUnitPrice,jdbcType=REAL}, #{wsUnitPrice,jdbcType=REAL}, 
      #{wsTaxRate,jdbcType=REAL}, #{puUnitPrice,jdbcType=REAL}, #{puTaxRate,jdbcType=REAL}, 
      #{venderId,jdbcType=INTEGER})
  </insert>
    <insert id="insertSelectiveUnitProdCls" parameterType="com.boyu.erp.platform.usercenter.entity.goods.UnitProdCls">
        insert into unit_prod_cls
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="unitId != null">
                unit_id,
            </if>
            <if test="prodClsId != null">
                prod_cls_id,
            </if>
            <if test="salesMode != null">
                sales_mode,
            </if>
            <if test="rcmdLvl != null">
                rcmd_lvl,
            </if>
            <if test="rtUnitPrice != null">
                rt_unit_price,
            </if>
            <if test="wsUnitPrice != null">
                ws_unit_price,
            </if>
            <if test="wsTaxRate != null">
                ws_tax_rate,
            </if>
            <if test="puUnitPrice != null">
                pu_unit_price,
            </if>
            <if test="puTaxRate != null">
                pu_tax_rate,
            </if>
            <if test="venderId != null">
                vender_id,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="unitId != null">
                #{unitId,jdbcType=BIGINT},
            </if>
            <if test="prodClsId != null">
                #{prodClsId,jdbcType=BIGINT},
            </if>
            <if test="salesMode != null">
                #{salesMode,jdbcType=CHAR},
            </if>
            <if test="rcmdLvl != null">
                #{rcmdLvl,jdbcType=INTEGER},
            </if>
            <if test="rtUnitPrice != null">
                #{rtUnitPrice,jdbcType=REAL},
            </if>
            <if test="wsUnitPrice != null">
                #{wsUnitPrice,jdbcType=REAL},
            </if>
            <if test="wsTaxRate != null">
                #{wsTaxRate,jdbcType=REAL},
            </if>
            <if test="puUnitPrice != null">
                #{puUnitPrice,jdbcType=REAL},
            </if>
            <if test="puTaxRate != null">
                #{puTaxRate,jdbcType=REAL},
            </if>
            <if test="venderId != null">
                #{venderId,jdbcType=INTEGER},
            </if>
        </trim>
    </insert>
    <update id="updateUnitProdClsSelective" parameterType="com.boyu.erp.platform.usercenter.entity.goods.UnitProdCls">
        update unit_prod_cls
        <set>
            <if test="salesMode != null">
                sales_mode = #{salesMode,jdbcType=CHAR},
            </if>
            <if test="rcmdLvl != null">
                rcmd_lvl = #{rcmdLvl,jdbcType=INTEGER},
            </if>
            <if test="rtUnitPrice != null">
                rt_unit_price = #{rtUnitPrice,jdbcType=REAL},
            </if>
            <if test="wsUnitPrice != null">
                ws_unit_price = #{wsUnitPrice,jdbcType=REAL},
            </if>
            <if test="wsTaxRate != null">
                ws_tax_rate = #{wsTaxRate,jdbcType=REAL},
            </if>
            <if test="puUnitPrice != null">
                pu_unit_price = #{puUnitPrice,jdbcType=REAL},
            </if>
            <if test="puTaxRate != null">
                pu_tax_rate = #{puTaxRate,jdbcType=REAL},
            </if>
            <if test="venderId != null">
                vender_id = #{venderId,jdbcType=INTEGER},
            </if>
        </set>
        where unit_id = #{unitId,jdbcType=BIGINT}
        and prod_cls_id = #{prodClsId,jdbcType=BIGINT}
    </update>
    <update id="updateUnitProdCls" parameterType="com.boyu.erp.platform.usercenter.entity.goods.UnitProdCls">
    update unit_prod_cls
    set sales_mode = #{salesMode,jdbcType=CHAR},
      rcmd_lvl = #{rcmdLvl,jdbcType=INTEGER},
      rt_unit_price = #{rtUnitPrice,jdbcType=REAL},
      ws_unit_price = #{wsUnitPrice,jdbcType=REAL},
      ws_tax_rate = #{wsTaxRate,jdbcType=REAL},
      pu_unit_price = #{puUnitPrice,jdbcType=REAL},
      pu_tax_rate = #{puTaxRate,jdbcType=REAL},
      vender_id = #{venderId,jdbcType=INTEGER}
    where unit_id = #{unitId,jdbcType=BIGINT}
      and prod_cls_id = #{prodClsId,jdbcType=BIGINT}
  </update>

    <!--系统管理员-->
    <select id="selectALL" parameterType="com.boyu.erp.platform.usercenter.vo.purchase.DtlProdVo"
            resultMap="BaseResultMapByDtl">
        SELECT
        p.prod_id AS prodId,
        pc.prod_cls_id AS prodClsId,
        pc.prod_cls_code AS prodClsCode,
        pc.prod_name AS prodName,
        upc.rt_unit_price AS rtUnitPrice,
        pc.input_code AS inputCode,
        scd.description AS edition,
        c.color_name AS color,
        s.spec_name AS spec,
        p.prod_code AS prodCode,
        upc.ws_unit_price AS wsUnitPrice ,
        pc.lst_price AS lstPrice,
        scd1.description AS uom,
        pc.seq_num AS seqNum,
        upc.pu_unit_price AS unitPrice,
        upc.pu_tax_rate AS taxRate,
        upc.ws_tax_rate AS wsTaxRate
        FROM
        (SELECT prod_cls_id,
        any_value ( rt_unit_price ) AS rt_unit_price,
        any_value ( ws_unit_price ) AS ws_unit_price,
        any_value ( pu_unit_price ) AS pu_unit_price,
        any_value ( pu_tax_rate ) AS pu_tax_rate ,
        any_value ( ws_tax_rate ) AS ws_tax_rate FROM unit_prod_cls GROUP BY prod_cls_id) upc
        INNER JOIN prod_cls pc ON pc.prod_cls_id = upc.prod_cls_id
        INNER JOIN product p ON p.prod_cls_id = upc.prod_cls_id
        LEFT JOIN color c ON c.color_id = pc.color_id AND c.deleted = 'F'
        LEFT JOIN spec s ON s.spec_id = pc.spec_id AND s.deleted = 'F'
        LEFT JOIN sys_code_dtl scd ON scd.`code` = pc.edition AND scd.code_type='EDITION'
        LEFT JOIN sys_code_dtl scd1 ON scd1.`code` = pc.uom AND scd1.code_type='UOM'
        where 1=1 AND pc.auditType='am' AND p.skuStatus='A'
        <if test="prodCode != null and prodCode != '' and prodCode != 'null' ">
            AND p.prod_code LIKE CONCAT(#{prodCode}, '%')
        </if>
        <if test="prodCatId != null and prodCatId != '' and prodCatId != 'null'">
            AND pc.prod_cat_id LIKE CONCAT(#{prodCatId}, '%')
        </if>
        <if test="prodName != null and prodName != '' and prodName != 'null'">
            AND pc.prod_name like CONCAT('%',#{prodName}, '%')
        </if>
        <if test="inputCode != null and inputCode != '' and inputCode != 'null'">
            AND pc.input_code LIKE CONCAT(#{inputCode}, '%')
        </if>
        <if test="brandId != null and brandId != '' ">
            AND pc.brand_id = #{brandId}
        </if>
        <if test="prodStatus != null and prodStatus != '' ">
            AND pc.prod_status = #{prodStatus}
        </if>
    </select>

    <!--组织或个人-->
    <select id="selectUserList" parameterType="com.boyu.erp.platform.usercenter.vo.purchase.DtlProdVo"
            resultMap="BaseResultMapByDtl">
        SELECT
        p.prod_id AS prodId,
        pc.prod_cat_id AS prodCatId,
        pc.prod_cls_id AS prodClsId,
        pc.prod_cls_code AS prodClsCode,
        pc.prod_name AS prodName,
        upc.rt_unit_price AS rtUnitPrice,
        pc.input_code AS inputCode,
        scd.description AS edition,
        c.color_name AS color,
        s.spec_name AS spec,
        p.prod_code AS prodCode,
        upc.ws_unit_price AS wsUnitPrice ,
        pc.lst_price AS lstPrice,
        scd1.description AS uom,
        pc.seq_num AS seqNum,
        upc.pu_unit_price AS unitPrice,
        upc.pu_tax_rate AS taxRate
        FROM
        (SELECT a.* FROM unit_prod_cls a WHERE 1=1 AND
        a.unit_id = #{sUnitId}
        )
        upc
        INNER JOIN prod_cls pc ON pc.prod_cls_id = upc.prod_cls_id and pc.ctrl_unit_id = upc.unit_id
        INNER JOIN product p ON p.prod_cls_id = upc.prod_cls_id
        LEFT JOIN color c ON c.color_id = pc.color_id AND c.deleted = 'F'
        LEFT JOIN spec s ON s.spec_id = pc.spec_id AND s.deleted = 'F'
        LEFT JOIN sys_code_dtl scd ON scd.`code` = pc.edition AND scd.code_type='EDITION'
        LEFT JOIN sys_code_dtl scd1 ON scd1.`code` = pc.uom AND scd1.code_type='UOM'
        WHERE 1=1 AND pc.auditType='am' AND p.skuStatus='A'
        <if test="prodCode != null and prodCode != '' and prodCode != 'null'">
            AND p.prod_code LIKE CONCAT(#{prodCode}, '%')
        </if>
        <if test="prodCatId != null and prodCatId != '' and prodCatId != 'null'">
            AND pc.prod_cat_id LIKE CONCAT(#{prodCatId}, '%')
        </if>
        <if test="prodName != null and prodName != '' and prodName != 'null'">
            AND pc.prod_name like CONCAT('%',#{prodName}, '%')
        </if>
        <if test="inputCode != null and inputCode != '' and inputCode != 'null'">
            AND pc.input_code LIKE CONCAT(#{inputCode}, '%')
        </if>
        <if test="brandId != null and brandId != '' ">
            AND pc.brand_id = #{brandId}
        </if>
        <if test="prodStatus != null and prodStatus != '' ">
            AND pc.prod_status = #{prodStatus}
        </if>
    </select>

    <select id="selectByProdCode" parameterType="com.boyu.erp.platform.usercenter.vo.purchase.DtlProdVo"
            resultMap="BaseResultMapByDtl">
        SELECT
        p.prod_id AS prodId,
        pc.prod_cat_id AS prodCatId,
        pc.prod_cls_id AS prodClsId,
        pc.prod_cls_code AS prodClsCode,
        pc.prod_name AS prodName,
        upc.rt_unit_price AS rtUnitPrice,
        pc.input_code AS inputCode,
        scd.description AS edition,
        c.color_name AS color,
        s.spec_name AS spec,
        p.prod_code AS prodCode,
        upc.ws_unit_price AS wsUnitPrice ,
        pc.lst_price AS lstPrice,
        scd1.description AS uom,
        pc.seq_num AS seqNum,
        upc.pu_unit_price AS unitPrice,
        upc.pu_tax_rate AS taxRate
        FROM
        (SELECT a.* FROM unit_prod_cls a WHERE 1=1 AND
        a.unit_id = #{sUnitId}
        )
        upc
        INNER JOIN prod_cls pc ON pc.prod_cls_id = upc.prod_cls_id and pc.ctrl_unit_id = upc.unit_id
        INNER JOIN product p ON p.prod_cls_id = upc.prod_cls_id
        LEFT JOIN color c ON c.color_id = pc.color_id AND c.deleted = 'F'
        LEFT JOIN spec s ON s.spec_id = pc.spec_id AND s.deleted = 'F'
        LEFT JOIN sys_code_dtl scd ON scd.`code` = pc.edition AND scd.code_type='EDITION'
        LEFT JOIN sys_code_dtl scd1 ON scd1.`code` = pc.uom AND scd1.code_type='UOM'
        WHERE 1=1 AND pc.auditType='am' AND p.skuStatus='A'

            AND p.prod_code = #{prodCode}
    </select>

    <select id="selectByDtlVo" parameterType="java.util.List"
            resultMap="BaseResultMapByDtl">
        SELECT
        p.prod_id AS prodId,
        pc.prod_cls_id AS prodClsId,
        pc.prod_cls_code AS prodClsCode,
        pc.prod_name AS prodName,
        upc.rt_unit_price AS rtUnitPrice,
        pc.input_code AS inputCode,
        scd.description AS edition,
        c.color_name AS color,
        s.spec_name AS spec,
        p.prod_code AS prodCode,
        upc.ws_unit_price AS wsUnitPrice ,
        pc.lst_price AS lstPrice,
        scd1.description AS uom,
        pc.seq_num AS seqNum,
        upc.pu_unit_price AS unitPrice,
        upc.pu_tax_rate AS taxRate,
        upc.ws_tax_rate AS wsTaxRate
        FROM
        unit_prod_cls upc
        INNER JOIN prod_cls pc ON pc.prod_cls_id = upc.prod_cls_id
        INNER JOIN product p ON p.prod_cls_id = upc.prod_cls_id
        LEFT JOIN color c ON c.color_id = pc.color_id AND c.deleted = 'F'
        LEFT JOIN spec s ON s.spec_id = pc.spec_id AND s.deleted = 'F'
        LEFT JOIN sys_code_dtl scd ON scd.`code` = pc.edition AND scd.code_type='EDITION'
        LEFT JOIN sys_code_dtl scd1 ON scd1.`code` = pc.uom AND scd1.code_type='UOM'
        where 1=1 and pc.prod_status = 'A'
        <foreach item="item" index="index" collection="list" open="(" separator="," close=")">
            AND p.prod_code = #{item.prodCode}
        </foreach>
    </select>


    <select id="selectBillALL" parameterType="com.boyu.erp.platform.usercenter.vo.purchase.BillDtlProdVo"
            resultMap="BaseResultMapByDtl">
        SELECT
            p.prod_id AS prodId,
            p.prod_code AS prodCode,
            prodCls.*
        FROM
            product p
            INNER JOIN (
            SELECT
                x.prodCatId,
                x.prodClsId,
                x.prodClsCode,
                x.prodName,
                x.inputCode,
                x.lstPrice,
                x.seqNum,
                x.color,
                x.edition,
                x.spec,
                x.uom,
                upc.rt_unit_price AS rtUnitPrice,
                upc.ws_unit_price AS wsUnitPrice,
                upc.pu_unit_price AS unitPrice,
                upc.pu_tax_rate AS taxRate,
                upc.ws_tax_rate AS wsTaxRate
            FROM
                (
                SELECT
                    pc.prod_cat_id AS prodCatId,
                    pc.prod_cls_id AS prodClsId,
                    pc.prod_cls_code AS prodClsCode,
                    pc.prod_name AS prodName,
                    pc.input_code AS inputCode,
                    pc.lst_price AS lstPrice,
                    pc.seq_num AS seqNum,
                    scd.description AS edition,
                    c.color_name AS color,
                    s.spec_name AS spec,
                    scd1.description AS uom
                FROM
                    prod_cls pc
                    LEFT JOIN (
                    SELECT
                        a.brand_id AS brandId
                    FROM
                        (
                        SELECT
                            t.brand_id AS brand_id
                        FROM
                            (
                            SELECT DISTINCT
                                u.brand_id AS brand_id
                            FROM
                                user_brand u
                            WHERE
                                u.user_id = #{userId}
                                AND u.owner_id = #{vendeeId}
                                AND u.is_del = 1 UNION
                            SELECT DISTINCT
                                d.brand_id AS brand_id
                            FROM
                                user_bg u
                                INNER JOIN bg_dtl d ON u.bg_id = d.bg_id
                            WHERE
                                u.user_id = #{userId}
                                AND u.owner_id = #{vendeeId}
                                AND u.is_del = 1
                            ) t
                        ) s
                        INNER JOIN brand a ON s.brand_id = a.`brand_id`
                    WHERE
                        a.brand_status = 'A'
                    ) userP ON userP.brandId = pc.brand_id
                    AND pc.auditType = 'am'
                    LEFT JOIN color c ON c.color_id = pc.color_id
                    AND c.deleted = 'F'
                    LEFT JOIN spec s ON s.spec_id = pc.spec_id
                    AND s.deleted = 'F'
                    LEFT JOIN sys_code_dtl scd ON scd.`code` = pc.edition
                    AND scd.code_type = 'EDITION'
                    LEFT JOIN sys_code_dtl scd1 ON scd1.`code` = pc.uom
                    AND scd1.code_type = 'UOM'
                WHERE
                    pc.isAudit = 1
                <if test="prodCatId != null and prodCatId != '' and prodCatId != 'null'">
                    AND pc.prod_cat_id LIKE CONCAT('%', #{prodCatId}, '%')
                </if>
                <if test="prodName != null and prodName != '' and prodName != 'null'">
                    AND pc.prod_name like CONCAT('%', #{prodName}, '%')
                </if>
                <if test="inputCode != null and inputCode != '' and inputCode != 'null'">
                    AND pc.input_code LIKE CONCAT('%', #{inputCode}, '%')
                </if>
                <if test="brandId != null and brandId != '' ">
                    AND pc.brand_id = #{brandId}
                </if>
                <if test="prodStatus != null and prodStatus != '' ">
                    AND pc.prod_status = #{prodStatus}
                </if>
                ) x
                INNER JOIN vdr_supply_prod vsp ON vsp.prod_cls_id = x.prodClsId
                AND vsp.vender_id = #{venderId}
                AND vsp.vendee_id = #{vendeeId}
                INNER JOIN unit_prod_cls upc ON upc.prod_cls_id = x.prodClsId
                AND upc.unit_id = vsp.vendee_id
            ) prodCls ON prodCls.prodClsId = p.prod_cls_id
        WHERE
            p.skuStatus = 'A'
        <if test="prodCode != null and prodCode != '' and prodCode != 'null'">
            AND p.prod_code LIKE CONCAT( '%', #{prodCode}, '%')
        </if>
    </select>

    <select id="findByBillProdCode" parameterType="com.boyu.erp.platform.usercenter.vo.purchase.BillDtlProdVo"
            resultMap="BaseResultMapByDtl">
        SELECT
        p.prod_id AS prodId,
        prodCls.*
        FROM
        product p
        INNER JOIN (
        SELECT
        x.prodCatId,
        x.prodClsId,
        x.prodClsCode,
        x.prodName,
        x.inputCode,
        x.lstPrice,
        x.seqNum,
        x.color,
        x.edition,
        x.spec,
        x.uom,
        upc.rt_unit_price AS rtUnitPrice,
        upc.ws_unit_price AS wsUnitPrice,
        upc.pu_unit_price AS unitPrice,
        upc.pu_tax_rate AS taxRate,
        upc.ws_tax_rate AS wsTaxRate
        FROM
        (
        SELECT
        pc.prod_cat_id AS prodCatId,
        pc.prod_cls_id AS prodClsId,
        pc.prod_cls_code AS prodClsCode,
        pc.prod_name AS prodName,
        pc.input_code AS inputCode,
        pc.lst_price AS lstPrice,
        pc.seq_num AS seqNum,
        scd.description AS edition,
        c.color_name AS color,
        s.spec_name AS spec,
        scd1.description AS uom
        FROM
        prod_cls pc
        LEFT JOIN (
        SELECT
        a.brand_id AS brandId
        FROM
        (
        SELECT
        t.brand_id AS brand_id
        FROM
        (
        SELECT DISTINCT
        u.brand_id AS brand_id
        FROM
        user_brand u
        WHERE
        u.user_id = #{userId}
        AND u.owner_id = #{vendeeId}
        AND u.is_del = 1 UNION
        SELECT DISTINCT
        d.brand_id AS brand_id
        FROM
        user_bg u
        INNER JOIN bg_dtl d ON u.bg_id = d.bg_id
        WHERE
        u.user_id = #{userId}
        AND u.owner_id = #{vendeeId}
        AND u.is_del = 1
        ) t
        ) s
        INNER JOIN brand a ON s.brand_id = a.`brand_id`
        WHERE
        a.brand_status = 'A'
        ) userP ON userP.brandId = pc.brand_id
        AND pc.auditType = 'am'
        LEFT JOIN color c ON c.color_id = pc.color_id
        AND c.deleted = 'F'
        LEFT JOIN spec s ON s.spec_id = pc.spec_id
        AND s.deleted = 'F'
        LEFT JOIN sys_code_dtl scd ON scd.`code` = pc.edition
        AND scd.code_type = 'EDITION'
        LEFT JOIN sys_code_dtl scd1 ON scd1.`code` = pc.uom
        AND scd1.code_type = 'UOM'
        WHERE
        pc.isAudit = 1
        AND pc.prod_status = 'A'
        ) x
        INNER JOIN vdr_supply_prod vsp ON vsp.prod_cls_id = x.prodClsId
        AND vsp.vender_id = #{venderId}
        AND vsp.vendee_id = #{vendeeId}
        INNER JOIN unit_prod_cls upc ON upc.prod_cls_id = x.prodClsId
        AND upc.unit_id = vsp.vendee_id
        ) prodCls ON prodCls.prodClsId = p.prod_cls_id
        WHERE
        p.skuStatus = 'A'
        AND p.prod_code = #{prodCode}
    </select>

    <select id="getByPower" parameterType="com.boyu.erp.platform.usercenter.vo.purchase.BillDtlProdVo"
            resultMap="BaseResultMapByDtl">
        SELECT
            p.prod_id AS prodId,
            p.prod_code AS prodCode,
            prodCls.*
        FROM
            product p
            INNER JOIN (
            SELECT
                x.prodCatId,
                x.prodClsId,
                x.prodClsCode,
                x.prodName,
                x.inputCode,
                x.lstPrice,
                x.seqNum,
                x.color,
                x.edition,
                x.spec,
                x.uom,
                upc.rt_unit_price AS rtUnitPrice,
                upc.ws_unit_price AS wsUnitPrice,
                upc.pu_unit_price AS unitPrice,
                upc.pu_tax_rate AS taxRate,
                upc.ws_tax_rate AS wsTaxRate
            FROM
                (
                SELECT
                    pc.prod_cat_id AS prodCatId,
                    pc.prod_cls_id AS prodClsId,
                    pc.prod_cls_code AS prodClsCode,
                    pc.prod_name AS prodName,
                    pc.input_code AS inputCode,
                    pc.lst_price AS lstPrice,
                    pc.seq_num AS seqNum,
                    scd.description AS edition,
                    c.color_name AS color,
                    s.spec_name AS spec,
                    scd1.description AS uom
                FROM
                    prod_cls pc
                    INNER JOIN (
                    SELECT
                        t.brand_id AS brandId
                    FROM
                        (
                        SELECT
                            y.brand_id AS brand_id
                        FROM
                            (
                            SELECT DISTINCT
                                u.brand_id AS brand_id
                            FROM
                                user_brand u
                            WHERE
                                u.user_id = #{userId}

                                AND u.owner_id = #{sUnitId}

                                AND u.is_del = 1 UNION
                            SELECT DISTINCT
                                d.brand_id AS brand_id
                            FROM
                                user_bg u
                                INNER JOIN bg_dtl d ON u.bg_id = d.bg_id
                            WHERE
                                u.user_id = #{userId}

                                AND u.owner_id = #{sUnitId}

                                AND u.is_del = 1
                            ) y
                            INNER JOIN brand a ON y.brand_id = a.`brand_id`
                            AND a.brand_status = 'A' UNION ALL
                        SELECT
                            x.brand_id AS brand_id
                        FROM
                            (
                            SELECT DISTINCT
                                u.brand_id AS brand_id
                            FROM
                                unit_brand u
                            WHERE
                                u.unit_id = #{sUnitId}

                                AND u.is_del = 1 UNION
                            SELECT DISTINCT
                                d.brand_id AS brand_id
                            FROM
                                unit_bg u
                                INNER JOIN bg_dtl d ON u.bg_id = d.bg_id
                            WHERE
                                u.unit_id = #{sUnitId}

                                AND u.is_del = 1
                            ) x
                            INNER JOIN brand a ON x.brand_id = a.`brand_id`
                            AND a.brand_status = 'A'
                        ) t
                    GROUP BY
                        t.brand_id
                    HAVING
                        COUNT( t.brand_id ) = 2
                    ) userP ON userP.brandId = pc.brand_id
                    AND pc.auditType = 'am'
                    LEFT JOIN color c ON c.color_id = pc.color_id
                    AND c.deleted = 'F'
                    LEFT JOIN spec s ON s.spec_id = pc.spec_id
                    AND s.deleted = 'F'
                    LEFT JOIN sys_code_dtl scd ON scd.`code` = pc.edition
                    AND scd.code_type = 'EDITION'
                    LEFT JOIN sys_code_dtl scd1 ON scd1.`code` = pc.uom
                    AND scd1.code_type = 'UOM'
                WHERE
                    pc.isAudit = 1
                <if test="prodCatId != null and prodCatId != '' and prodCatId != 'null'">
                    AND pc.prod_cat_id LIKE CONCAT('%', #{prodCatId}, '%')
                </if>
                <if test="prodName != null and prodName != '' and prodName != 'null'">
                    AND pc.prod_name like CONCAT('%', #{prodName}, '%')
                </if>
                <if test="inputCode != null and inputCode != '' and inputCode != 'null'">
                    AND pc.input_code LIKE CONCAT('%', #{inputCode}, '%')
                </if>
                <if test="brandId != null and brandId != '' ">
                    AND pc.brand_id = #{brandId}
                </if>
                <if test="prodStatus != null and prodStatus != '' ">
                    AND pc.prod_status = #{prodStatus}
                </if>
                ) x
                INNER JOIN unit_prod_cls upc ON upc.prod_cls_id = x.prodClsId
                AND upc.unit_id = #{sUnitId}
            ) prodCls ON prodCls.prodClsId = p.prod_cls_id
        WHERE
            p.skuStatus = 'A' AND p.is_del = 1
    </select>

    <select id="getByVdrSupply" parameterType="com.boyu.erp.platform.usercenter.vo.purchase.BillDtlProdVo"
            resultMap="BaseResultMapByDtl">
        SELECT
            p.prod_id AS prodId,
            p.prod_code AS prodCode,
            prodCls.*
        FROM
            product p
            INNER JOIN (
            SELECT
                x.prodCatId,
                x.prodClsId,
                x.prodClsCode,
                x.prodName,
                x.inputCode,
                x.lstPrice,
                x.seqNum,
                x.color,
                x.edition,
                x.spec,
                x.uom,
                upc.rt_unit_price AS rtUnitPrice,
                upc.ws_unit_price AS wsUnitPrice,
                upc.pu_unit_price AS unitPrice,
                upc.pu_tax_rate AS taxRate,
                upc.ws_tax_rate AS wsTaxRate
            FROM
                (
                SELECT
                    pc.prod_cat_id AS prodCatId,
                    pc.prod_cls_id AS prodClsId,
                    pc.prod_cls_code AS prodClsCode,
                    pc.prod_name AS prodName,
                    pc.input_code AS inputCode,
                    pc.lst_price AS lstPrice,
                    pc.seq_num AS seqNum,
                    scd.description AS edition,
                    c.color_name AS color,
                    s.spec_name AS spec,
                    scd1.description AS uom
                FROM
                    prod_cls pc
                    INNER JOIN (
                    SELECT
                        t.brand_id AS brandId
                    FROM
                        (
                        SELECT
                            y.brand_id AS brand_id
                        FROM
                            (
                            SELECT DISTINCT
                                u.brand_id AS brand_id
                            FROM
                                user_brand u
                            WHERE
                                u.user_id = #{userId}
                                AND u.owner_id = #{sUnitId}
                                AND u.is_del = 1 UNION
                            SELECT DISTINCT
                                d.brand_id AS brand_id
                            FROM
                                user_bg u
                                INNER JOIN bg_dtl d ON u.bg_id = d.bg_id
                            WHERE
                                u.user_id = #{userId}
                                AND u.owner_id = #{sUnitId}
                                AND u.is_del = 1
                            ) y
                            INNER JOIN brand a ON y.brand_id = a.`brand_id`
                            AND a.brand_status = 'A' UNION ALL
                        SELECT
                            x.brand_id AS brand_id
                        FROM
                            (
                            SELECT DISTINCT
                                u.brand_id AS brand_id
                            FROM
                                unit_brand u
                            WHERE
                                u.unit_id = #{sUnitId}
                                AND u.is_del = 1 UNION
                            SELECT DISTINCT
                                d.brand_id AS brand_id
                            FROM
                                unit_bg u
                                INNER JOIN bg_dtl d ON u.bg_id = d.bg_id
                            WHERE
                                u.unit_id = #{sUnitId}
                                AND u.is_del = 1
                            ) x
                            INNER JOIN brand a ON x.brand_id = a.`brand_id`
                            AND a.brand_status = 'A'
                        ) t
                    GROUP BY
                        t.brand_id
                    HAVING
                        COUNT( t.brand_id ) = 2
                    ) userP ON userP.brandId = pc.brand_id
                    AND pc.auditType = 'am'
                    LEFT JOIN color c ON c.color_id = pc.color_id
                    AND c.deleted = 'F'
                    LEFT JOIN spec s ON s.spec_id = pc.spec_id
                    AND s.deleted = 'F'
                    LEFT JOIN sys_code_dtl scd ON scd.`code` = pc.edition
                    AND scd.code_type = 'EDITION'
                    LEFT JOIN sys_code_dtl scd1 ON scd1.`code` = pc.uom
                    AND scd1.code_type = 'UOM'
                WHERE
                    pc.isAudit = 1
                    <if test="prodCatId != null and prodCatId != '' and prodCatId != 'null'">
                        AND pc.prod_cat_id LIKE CONCAT('%', #{prodCatId}, '%')
                    </if>
                    <if test="prodName != null and prodName != '' and prodName != 'null'">
                        AND pc.prod_name like CONCAT('%', #{prodName}, '%')
                    </if>
                    <if test="inputCode != null and inputCode != '' and inputCode != 'null'">
                        AND pc.input_code LIKE CONCAT('%', #{inputCode}, '%')
                    </if>
                    <if test="brandId != null and brandId != '' ">
                        AND pc.brand_id = #{brandId}
                    </if>
                    <if test="prodStatus != null and prodStatus != '' ">
                        AND pc.prod_status = #{prodStatus}
                    </if>
                ) x
                INNER JOIN vdr_supply_prod vsp ON vsp.prod_cls_id = x.prodClsId
                AND vsp.vender_id = #{venderId}
                AND vsp.vendee_id = #{vendeeId}
                INNER JOIN unit_prod_cls upc ON upc.prod_cls_id = x.prodClsId
                AND upc.unit_id = vsp.vendee_id
            ) prodCls ON prodCls.prodClsId = p.prod_cls_id
        WHERE
            p.skuStatus = 'A'
            AND p.is_del =1
            <if test="prodCode != null and prodCode != '' and prodCode != 'null'">
                AND p.prod_code LIKE CONCAT( '%', #{prodCode}, '%')
            </if>
    </select>

    <select id="getByNoVdrSupply" parameterType="com.boyu.erp.platform.usercenter.vo.purchase.BillDtlProdVo"
            resultMap="BaseResultMapByDtl">
        SELECT
        p.prod_id AS prodId,
        p.prod_code AS prodCode,
        prodCls.*
        FROM
        product p
        INNER JOIN (
        SELECT
        x.prodCatId,
        x.prodClsId,
        x.prodClsCode,
        x.prodName,
        x.inputCode,
        x.lstPrice,
        x.seqNum,
        x.color,
        x.edition,
        x.spec,
        x.uom,
        upc.rt_unit_price AS rtUnitPrice,
        upc.ws_unit_price AS wsUnitPrice,
        upc.pu_unit_price AS unitPrice,
        upc.pu_tax_rate AS taxRate,
        upc.ws_tax_rate AS wsTaxRate
        FROM
        (
        SELECT
        pc.prod_cat_id AS prodCatId,
        pc.prod_cls_id AS prodClsId,
        pc.prod_cls_code AS prodClsCode,
        pc.prod_name AS prodName,
        pc.input_code AS inputCode,
        pc.lst_price AS lstPrice,
        pc.seq_num AS seqNum,
        scd.description AS edition,
        c.color_name AS color,
        s.spec_name AS spec,
        scd1.description AS uom
        FROM
        prod_cls pc
        INNER JOIN (
        SELECT
        t.brand_id AS brandId
        FROM
        (
        SELECT
        y.brand_id AS brand_id
        FROM
        (
        SELECT DISTINCT
        u.brand_id AS brand_id
        FROM
        user_brand u
        WHERE
        u.user_id = #{userId}
        AND u.owner_id = #{sUnitId}
        AND u.is_del = 1 UNION
        SELECT DISTINCT
        d.brand_id AS brand_id
        FROM
        user_bg u
        INNER JOIN bg_dtl d ON u.bg_id = d.bg_id
        WHERE
        u.user_id = #{userId}
        AND u.owner_id = #{sUnitId}
        AND u.is_del = 1
        ) y
        INNER JOIN brand a ON y.brand_id = a.`brand_id`
        AND a.brand_status = 'A' UNION ALL
        SELECT
        x.brand_id AS brand_id
        FROM
        (
        SELECT DISTINCT
        u.brand_id AS brand_id
        FROM
        unit_brand u
        WHERE
        u.unit_id = #{sUnitId}
        AND u.is_del = 1 UNION
        SELECT DISTINCT
        d.brand_id AS brand_id
        FROM
        unit_bg u
        INNER JOIN bg_dtl d ON u.bg_id = d.bg_id
        WHERE
        u.unit_id = #{sUnitId}
        AND u.is_del = 1
        ) x
        INNER JOIN brand a ON x.brand_id = a.`brand_id`
        AND a.brand_status = 'A'
        ) t
        GROUP BY
        t.brand_id
        HAVING
        COUNT( t.brand_id ) = 2
        ) userP ON userP.brandId = pc.brand_id
        AND pc.auditType = 'am'
        LEFT JOIN color c ON c.color_id = pc.color_id
        AND c.deleted = 'F'
        LEFT JOIN spec s ON s.spec_id = pc.spec_id
        AND s.deleted = 'F'
        LEFT JOIN sys_code_dtl scd ON scd.`code` = pc.edition
        AND scd.code_type = 'EDITION'
        LEFT JOIN sys_code_dtl scd1 ON scd1.`code` = pc.uom
        AND scd1.code_type = 'UOM'
        WHERE
        pc.isAudit = 1
        <if test="prodCatId != null and prodCatId != '' and prodCatId != 'null'">
            AND pc.prod_cat_id LIKE CONCAT('%', #{prodCatId}, '%')
        </if>
        <if test="prodName != null and prodName != '' and prodName != 'null'">
            AND pc.prod_name like CONCAT('%', #{prodName}, '%')
        </if>
        <if test="inputCode != null and inputCode != '' and inputCode != 'null'">
            AND pc.input_code LIKE CONCAT('%', #{inputCode}, '%')
        </if>
        <if test="brandId != null and brandId != '' ">
            AND pc.brand_id = #{brandId}
        </if>
        <if test="prodStatus != null and prodStatus != '' ">
            AND pc.prod_status = #{prodStatus}
        </if>
        ) x
        INNER JOIN unit_prod_cls upc ON upc.prod_cls_id = x.prodClsId
        AND upc.unit_id = #{sUnitId}
        ) prodCls ON prodCls.prodClsId = p.prod_cls_id
        WHERE
        p.skuStatus = 'A'
        AND p.is_del =1
        <if test="prodCode != null and prodCode != '' and prodCode != 'null'">
            AND p.prod_code LIKE CONCAT( '%', #{prodCode}, '%')
        </if>
    </select>

    <select id="findByNoVdrSupply" parameterType="com.boyu.erp.platform.usercenter.vo.purchase.BillDtlProdVo"
            resultMap="BaseResultMapByDtl">
        SELECT
        p.prod_id AS prodId,
        p.prod_code AS prodCode,
        prodCls.*
        FROM
        product p
        INNER JOIN (
        SELECT
        x.prodCatId,
        x.prodClsId,
        x.prodClsCode,
        x.prodName,
        x.inputCode,
        x.lstPrice,
        x.seqNum,
        x.color,
        x.edition,
        x.spec,
        x.uom,
        upc.rt_unit_price AS rtUnitPrice,
        upc.ws_unit_price AS wsUnitPrice,
        upc.pu_unit_price AS unitPrice,
        upc.pu_tax_rate AS taxRate,
        upc.ws_tax_rate AS wsTaxRate
        FROM
        (
        SELECT
        pc.prod_cat_id AS prodCatId,
        pc.prod_cls_id AS prodClsId,
        pc.prod_cls_code AS prodClsCode,
        pc.prod_name AS prodName,
        pc.input_code AS inputCode,
        pc.lst_price AS lstPrice,
        pc.seq_num AS seqNum,
        scd.description AS edition,
        c.color_name AS color,
        s.spec_name AS spec,
        scd1.description AS uom
        FROM
        prod_cls pc
        INNER JOIN (
        SELECT
        t.brand_id AS brandId
        FROM
        (
        SELECT
        y.brand_id AS brand_id
        FROM
        (
        SELECT DISTINCT
        u.brand_id AS brand_id
        FROM
        user_brand u
        WHERE
        u.user_id = #{userId}
        AND u.owner_id = #{vendeeId}
        AND u.is_del = 1 UNION
        SELECT DISTINCT
        d.brand_id AS brand_id
        FROM
        user_bg u
        INNER JOIN bg_dtl d ON u.bg_id = d.bg_id
        WHERE
        u.user_id = #{userId}
        AND u.owner_id = #{vendeeId}
        AND u.is_del = 1
        ) y
        INNER JOIN brand a ON y.brand_id = a.`brand_id`
        AND a.brand_status = 'A' UNION ALL
        SELECT
        x.brand_id AS brand_id
        FROM
        (
        SELECT DISTINCT
        u.brand_id AS brand_id
        FROM
        unit_brand u
        WHERE
        u.unit_id = #{vendeeId}
        AND u.is_del = 1 UNION
        SELECT DISTINCT
        d.brand_id AS brand_id
        FROM
        unit_bg u
        INNER JOIN bg_dtl d ON u.bg_id = d.bg_id
        WHERE
        u.unit_id = #{vendeeId}
        AND u.is_del = 1
        ) x
        INNER JOIN brand a ON x.brand_id = a.`brand_id`
        AND a.brand_status = 'A'
        ) t
        GROUP BY
        t.brand_id
        HAVING
        COUNT( t.brand_id ) = 2
        ) userP ON userP.brandId = pc.brand_id
        AND pc.auditType = 'am' AND pc.shared = 'T'
        LEFT JOIN color c ON c.color_id = pc.color_id
        AND c.deleted = 'F'
        LEFT JOIN spec s ON s.spec_id = pc.spec_id
        AND s.deleted = 'F'
        LEFT JOIN sys_code_dtl scd ON scd.`code` = pc.edition
        AND scd.code_type = 'EDITION'
        LEFT JOIN sys_code_dtl scd1 ON scd1.`code` = pc.uom
        AND scd1.code_type = 'UOM'
        WHERE
        pc.isAudit = 1
        <if test="prodCatId != null and prodCatId != '' and prodCatId != 'null'">
            AND pc.prod_cat_id LIKE CONCAT('%', #{prodCatId}, '%')
        </if>
        <if test="prodName != null and prodName != '' and prodName != 'null'">
            AND pc.prod_name like CONCAT('%', #{prodName}, '%')
        </if>
        <if test="inputCode != null and inputCode != '' and inputCode != 'null'">
            AND pc.input_code LIKE CONCAT('%', #{inputCode}, '%')
        </if>
        <if test="brandId != null and brandId != '' ">
            AND pc.brand_id = #{brandId}
        </if>
        <if test="prodStatus != null and prodStatus != '' ">
            AND pc.prod_status = #{prodStatus}
        </if>
        ) x
        INNER JOIN unit_prod_cls upc ON upc.prod_cls_id = x.prodClsId
        AND upc.unit_id = #{venderId}
        ) prodCls ON prodCls.prodClsId = p.prod_cls_id
        WHERE
        p.skuStatus = 'A'
        AND p.is_del =1
        <if test="prodCode != null and prodCode != '' and prodCode != 'null'">
            AND p.prod_code LIKE CONCAT( '%', #{prodCode}, '%')
        </if>
    </select>

</mapper>